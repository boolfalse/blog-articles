
## thread pool, ีกีถีกีฌีธีฃ ีผีฅีกีฌ ีฏีตีกีถึีซึ (ีดีกีฝ 5/7)

### NGNTJS - ีดีกีฝ 5

---

NGNTJS ีฐีธีคีพีกีฎีกีทีกึีซ ีถีกีญีธึีค [ีดีกีฝ 4](https://medium.com/@boolfalse/libuv-event-loop-%D5%AE%D5%A1%D5%B6%D5%B8%D5%A9%D5%B8%D6%82%D5%A9%D5%B5%D5%B8%D6%82%D5%B6-886772ab3df)ึีธึีด ีดีฅีถึ ีคีซีฟีกึีฏีฅึีซีถึ libUV ีฃึีกีคีกึีกีถีจ, ีฎีกีถีธีฉีกึีกีถึ event-loop ีดีฅีญีกีถีซีฆีดีซ ีกีทีญีกีฟีกีถึีซ ีฐีฅีฟึ
ิฑีตีฝ ีดีกีฝีจ ีฏีฌีซีถีซ [libUV](https://github.com/libuv/libuv)ึีซ "thread pool" ีฏีธีนีพีธีฒ featureึีซ ีดีกีฝีซีถึ

<img src="https://i.imgur.com/Cuai8DB.png" style="width:100%;">

[ีีฏีกึีจี [unsplash.com](https://unsplash.com/photos/4ftI4lCcByM)]

Thread poolึีจ ีถีกีญีกีฟีฅีฝีพีกีฎ ีง ีฏีกีฟีกึีฅีฌีธึ JavaScriptึีซ blocking operationึีถีฅึีจ: ิปีถีนีบีฅีฝ ีดีซีฃีธึึีฅ ีกึีคีฅีถ ีฃีซีฟีฅีถึี JavaScript executionึีซ ีฐีกีดีกึ (ีธึีบีฅีฝ runtimeี ีถีกึ Node.jsึีธึีด) ีถีกีญีกีฟีฅีฝีพีกีฎ ีง ีดีฅีฏ thread, ึ ีกีตีค threadึีธึีด ีชีกีดีกีถีกีฏีซ ีฟีพีตีกีฌ ีบีกีฐีซีถ ีฏีกีฟีกึีพีธึีด ีง ีดีซ ีฃีธึีฎีธีฒีธึีฉีตีธึีถึ ิตึีข ีฏีธีคีซ executionึีซ ีชีกีดีกีถีกีฏ ีฐีกีถีคีซีบีธึีด ีฅีถ  blocking operationึีถีฅึ, ีซีถีนีบีซีฝีซึ ีฅีถ ีฐีฅีฟึีตีกีฌ ีดีฅีฉีธีคีถีฅึีจ

- [fs](https://nodejs.org/api/fs.html) (fs.createReadStream(), fs.chown(), fs.copyFile())
- [crypto](https://nodejs.org/api/crypto.html) (crypto.scrypt(), crypto.sign(), crypto.verify())
- [dns](https://nodejs.org/api/dns.html) (dns.lookup(), dns.resolveCname() )

ีฏีกีด ีทีกีฟ ีกีตีฌ ีกีฝีซีถีญึีธีถ ีดีฅีฉีธีคีถีฅึ, ีกีบีก ีดีซีกีฏ threadึีซ ีกีทีญีกีฟีกีถึีจ ีนีฎีกีถึีกีขีฅีผีถีฅีฌีธึ ีฐีกีดีกึ "ีขีกึีพีธึีด ีฅีถ" ีฐีกีพีฅีฌีตีกีฌ threadึีฅึึ ิปึีกีฏีกีถีธึีด ีกีดีฅีถ ีดีซ threadึีซ poolingึีจ ีธึ ึีฃีฟีกีฃีธึีฎีธึีดีจ ีขีกีพีกีฏีกีถีซีถ ีผีฅีฝีธึึีฝ ีฎีกีญีฝีธีฒ ีง, ึ ีฝีก ีฏีกีฟีกึีพีธึีด ีง ีกีตีถ ีคีฅีบึีฅึีธึีด, ีฅึีข "ีกีตีฌ ีฟีกึีขีฅึีกีฏ ีนีฏีก" master threadึีซ ีกีทีญีกีฟีกีถึีจ block ีนีกีถีฅีฌีธึ ีฐีกีดีกึึ

<img src="https://i.imgur.com/VGrWoh5.png" style="width:100%;">
 
[Manufacturing single lane]

master threadึีซึ thread poolึีซ ีฃีธึีฎีธีฒีธึีฉีตีธึีถีจ ีกีพีฅีฌีซ ีฌีกีพ ีบีกีฟีฏีฅึีกึีถีฅีฌีธึ ีฐีกีดีกึ ึีธึีฑีฅีถึ ีฏีซึีกีผีฅีฌ ีถีดีกีถีกีฟีซีบ ีกีถีกีฌีธีฃ ีผีฅีกีฌ ีฏีตีกีถึีซึโค

ิดีซีฟีกึีฏีฅีถึ ีฃีธึีฎีกึีกีถีซ ีกีพีกีฃ ีกีทีญีกีฟีกีฏีซึ, ีธีพ ีฐีฅีฟึีธึีด ีง ีฃีฎีธีพ ีกีถึีถีธีฒ ึีกีฉีฅีฉีกีพีธึีพีกีฎ ีกีบึีกีถึีถีฅึีซ ีทีกึีชีซีถ, ีธึ ีถีก ีบีกีฟีกีฝีญีกีถีกีฟีธึ ีง ึีกีฉีฅีฉีกีพีธึีพีกีฎ ีกีบึีกีถึีถีฅึีซ ีพึีก ึีกีทีฅึีซ ีบีซีฟีกีฏีถีฅึีซ ีฐีกีดีกึึ ิฑีทีญีกีฟีกีถึีซ ีจีถีฉีกึีธึีด ีฌีซีถีธึีด ีฅีถ ีคีฅีบึีฅึ, ีฅึีข ึีกีฉีฅีฉีกีพีธึีพีกีฎ ีกีบึีกีถึีจ ีขีกีพีกีฏีกีถ ีฎีกีถึ ีง ีฌีซีถีธึีด ึ ีกีตีค ีกีพีกีฃ ีกีทีญีกีฟีกีฏีซึีจ ีซ ีพีซีณีกีฏีซ ีนีง ีฏีทีผีฅีฌ ีกีตีถึ ิฑีตีฝ ีคีฅีบึีฅึีซ ีฐีกีดีกึ ีถีก ีธึีถีซ ีฐีกีฟีฏีกึีพีกีฎ ีฏึีฟีฝีฅึ ึีฃีถีกีฏีกีถีถีฅึ, ีธีพึีฅึ ีฏีกึีธีฒ ีฅีถ ีพีฅึึีถีฅีฌ ีกีตีค ีฎีกีถึ ึีกีฉีฅีฉีจ, ีฏีทีผีฅีฌ ีกีตีถ ีดีฅีฎ ีฏีทีฅีผึีซ ีพึีก, ีกีฝีฅีฌ ีกีพีกีฃ ีกีทีญีกีฟีกีฏึีซีถ ึีกีทีจี ีธึีบีฅีฝีฆีซ ีถีก ีบีซีฟีกีฏีกีพีธึีซ ึีกีฉีฅีฉีจ ึ ีฟีฅีฒีกีคึีฅีฌ ีฃีฎีซ ีกีถึีกีฎ ีกีบึีกีถึีถีฅึีซ ีดีกีฝีธึีดึ ิฑีถีฏีกีญ ึีกีทีซึี ีกีดีฅีถ ีฎีกีถึ ีกีบึีกีถึีจ ีฏีทีผีฅีฌีธึ ีฐีกีดีกึ ีบีกีฟีกีฝีญีกีถีกีฟีธึ ีง 1 ีฏึีฟีฝีฅึ ีกีทีญีกีฟีกีฏีซึึ ิฟึีฟีฝีฅึ ีกีทีญีกีฟีกีฏีซึีถีฅึีจ ีฅึีซีฟีกีฝีกึีค ึีฃีถีกีฏีกีถีถีฅึ ีฅีถ, ีธีพึีฅึ ีบีกึีกีบ ีนีฅีถ, ีกีตีฌ ีกีทีญีกีฟีธึีด ีฅีถ ีฃีธึีฎีกึีกีถีซ ีฟีกึีขีฅึ ีฅีถีฉีกีดีกีฝีฅึีธึีด ึ ึีกีถีฏีกึีกีฎ ีฐีกึึีดีกีถ ีบีกีฐีซีถ ีบีกีฟึีกีฝีฟ ีฅีถ ึีฃีถีฅีฌ ีฟีพีตีกีฌ ีฐีกึึีฅึีซ ีคีฅีบึีธึีดึ
ิฑีพีกีฃ ีกีทีญีกีฟีกีฏีซึีจ ีบีกีฟีกีฝีญีกีถีกีฟีธึ ีง ีบีซีฟีกีฏีกีพีธึีดีกีถ ีฐีกีดีกึ, ีถีก ีฐีฅีฟึีธึีด ีง ีฃีฎีซีถี ีฎีกีถึ ีกีบึีกีถึีถีฅึีซ ีคีฅีบึีธึีด ีคีซีดีธึีด ีง ึีฃีถีกีฏีกีถีถีฅึีซีถ, ีซีฝีฏ ีฉีฅีฉึ ีกีบึีกีถึีถีฅึีจ ีฏีทีผีธึีด ีง ีซีถึีถีธึึีธึีตีถึ ิฑีพีกีฃ ีกีทีญีกีฟีกีฏีซึีจ ีฐีซีดีถีกีฏีกีถีธึีด ึีธึีฑีธึีด ีง ีนีคีซีดีฅีฌ ึีฃีถีกีฏีถีถีฅึีซ ีฌึีกึีธึึีซีน ึีฃีถีธึีฉีตีกีถีจ, ึีกีถีซ ีธึ ึีฃีถีกีฏีกีถ ีกีทีญีกีฟีกีฏีซึีถีฅึีจ ึีฝ ีฏีกีฟีกึีธึีด ีฅีถ ีซีถีนึีธึ ีฃีธึีฎีฅึ ีฃีธึีฎีกึีกีถีซ ีฟีกึีขีฅึ ีฐีกีฟีพีกีฎีถีฅึีธึีด, ีฉีฅึึีฝ ีฐีฅีฟึีฅีฌีธีพ ีกีพีกีฃ ีกีทีญีกีฟีกีฏึีซีถี ีกีถีฐึีกีชีฅีทีฟีธึีฉีตีกีถ ีคีฅีบึีธึีด ีทีฟีกีบ ึีฃีถีธึีฉีตีกีถ ีฐีกีฝีถีฅีฌีธึ ีถึีกีถึ ิฑีตีถีธึีกีดีฅีถีกีตีถีซีพ ีจีฝีฟ ีฐีกีฝีฟีซึีซี ีกีพีกีฃ ีกีทีญีกีฟีกีฏีซึีถ ีซึีฅีถ ีฏึีพีกีฎ ีธึีถีซ 4 ึีฃีถีกีฏีกีถ, ีธึีธีถึ ีฏีฃีกีถ ึีฃีถีธึีฉีตีกีถึ ิปีฐีกึีฏีฅ ีกีพีกีฃีจ ีคีซีดีธึีด ีง ีถึีกีถึ ีจีฝีฟ ีกีถีฐึีกีชีฅีทีฟีธึีฉีตีกีถ, ึ ีฐีถีกึีกีพีธึีซีถีฝ ึีซีน ึีกีถีกีฏีธีพึ
ิฑีตีฝีบีซีฝีธีพ, ีจีฝีฟ ีกีทีญีกีฟีกีถึีกีตีซีถ ีฏีกีถีธีถีกีคึีธึีฉีตีกีถ, ีกีทีญีกีฟีกีถึีซ ีจีถีฉีกึีธึีด ีฃึีกีถึีพีธีฒ ีฐีฅีฟึีตีกีฌ ีคีฅีบึีฅึีซ ีฐีกีดีกึ ีฏีฏีซึีกีผีพีซ ีฐีกีดีกีบีกีฟีกีฝีญีกีถ ีฃีธึีฎีธีฒีธึีฉีตีธึีถโค

- ิธีถีคีกีดีฅีถีจ 1 ีฎีกีถึ ีขีฅีผีซ ีฐีกีดีกึ ีกีพีกีฃีจ ีคีซีดีธึีด ีง 1 ีฏึีฟีฝีฅึีซ
- ิปึีกึ ีฐีฅีฟึีซึ ีฅีฏีธีฒ 2 ีฎีกีถึ ีขีฅีผีซ ีฐีกีดีกึ ีกีพีกีฃีจ ีคีซีดีธึีด ีง 2 ีฏึีฟีฝีฅึีซ ีดีซีกีชีกีดีกีถีกีฏ
- ิปึีกึ ีฐีฅีฟึีซึ ีฅีฏีธีฒ 3 ีฎีกีถึ ีขีฅีผีซ ีฐีกีดีกึ ีกีพีกีฃีจ ีคีซีดีธึีด ีง 3 ีฏึีฟีฝีฅึีซ ีดีซีกีชีกีดีกีถีกีฏ
- ิปึีกึ ีฐีฅีฟึีซึ ีฅีฏีธีฒ 4 ีฎีกีถึ ีขีฅีผีซ ีฐีกีดีกึ ีกีพีกีฃีจ ีคีซีดีธึีด ีง 4 ีฏึีฟีฝีฅึีซ ีดีซีกีชีกีดีกีถีกีฏ
- ิปึีกึ ีฐีฅีฟึีซึ ีฅีฏีธีฒ 4ึีซึ ีกีพีฅีฌ ีขีฅีผีฅึีซ ีฐีกีดีกึ ีกีพีกีฃีจ ีนีซ ีฏีกึีธีฒ ีคีซีดีฅีฌ ีกีตีฌ ึีฃีถีกีฏีกีถีซึ ีีฟีกึีพีธึีด ีงี ีกีตีฝีบีซีฝีซ ีคีฅีบึีฅึีธึีด 4 ึีฃีถีกีฏีกีถีถีฅึีจ ีฐีกีดีกีบีกีฟีกีฝีญีกีถีกีขีกึ ีพีฅึึีถีธึีด ีฅีถ ีซึีฅีถึ ีขีฅีผีฅึีจ ีฏีทีผีฅีฌีธึ ีฐีฅึีฉีกีฏีกีถีธึีฅีถ, ึ ีถึีกีถึีซึ ีธีพ ีกีพีฅีฌีซ ีทีธึีฟ ีง ีกีพีกึีฟีธึีด ีฏีทีผีฅีฌีจ ีธึ ีกีฝีธึีด ึีกีทีจ ีกีพีกีฃีซีถ, ีถีก ีทีกึีธึีถีกีฏีธึีด ีง ีพีฅึึีถีฅีฌ ีฐีฅึีฉีกีฏีกีถ ีฎีกีถึ ีขีฅีผีจี ีนีฝีบีกีฝีฅีฌีธีพ ีดีตีธึีฝีถีฅึีซีถึ ิตีพ ีกึีคีฅีถ ีซีถีนึีธึ ีบีกีฐีซ ีฅึีข ีถึีกีถึีซึ ีดีฅีฏีจ ีกีฆีกีฟีพีธึีด ีง ึ ีฟีฅีฝีถีธึีด ีง ีธึ ีงีฌ ีฎีกีถึ ีขีฅีผ ีนีซ ีดีถีกึีฅีฌ, ีถีก ีนีฝีบีกีฝีฅีฌีธีพ ีดีตีธึีฝ ึีฃีถีกีฏีกีถีถีฅึีซีถ, ีกีถีดีซีปีกีบีฅีฝ ีฐีฅีผีกีถีธึีด ีง ีซึ ีฃีธึีฎีฅึีธีพึ

ิผีซีถีธึีด ีฅีถ ีคีฅีบึีฅึ, ีฅึีข ีฎีกีถึีกีขีฅีผีถีพีกีฎีธึีฉีตีธึีถีจ ีทีกีฟีกีถีธึีด ีง, ึ ีกีพีกีฃ ีกีทีญีกีฟีกีฏึีซีถ ีกีถีฐึีกีชีฅีทีฟ ีง ีฌีซีถีธึีด ึีฃีฟีพีฅีฌ ีฐีกีพีฅีฌีตีกีฌ ีฏึีฟีฝีฅึ ีกีทีญีกีฟีกีฏีซึีถีฅึีซ ึีฃีถีธึีฉีตีธึีถีซึึ ีีดีกีถ ีคีฅีบึีฅึีธึีด ีฃีธึีฎีกึีกีถีซ ีฟีถึึีฅีถีซ ีฐีกีดีกึ ีฐีถีกึีกีพีธึีธึีฉีตีธึีถ ีฏีก ึีธึีธีญีฅีฌีธึ ีฏีกีถีธีถีกีฏีกึีฃีจ, ึ ีฉีธึีตีฌีกีฟึีฅีฌ ีกีพีกีฃ ีกีทีญีกีฟีกีฏึีซีถ ีดีซีกีชีกีดีกีถีกีฏ ีคีซีดีฅีฌีธึ 4ึีซึ ีกีพีฅีฌีซ ีกีทีญีกีฟีกีฏีซึีถีฅึีซ (ีซีฐีกึีฏีฅ ีถีกึ ีฏีกึีธีฒ ีง ึีนีกึีถีฅีฌ ีกีตีถ):

ิฑีตีฝ ีฅึึีกีฏีกีตีกีฏีกีถ ึึีซีถีกีฏีจ ีผีฅีกีฌ ีฏีตีกีถึีซึ ีดีซีฟีพีกีฎ ีงึ ีกีถีฅีฌีธึ ีฐีกีดีฅีดีกีฟีธึีฉีตีธึีถ ีฐีฅีฟึีตีกีฌ ีฟีฅึีดีซีถีถีฅึีซ ีดีซีปึโค

- **master thread** - ีกีพีกีฃ ีกีทีญีกีฟีกีฏีซึ
- **thread** - ีกีดีฅีถ ีดีซ (ึีฃีถีกีฏีกีถ) ีกีทีญีกีฟีกีฏีซึีจ
- **thread pool** - ีคีซีดีธึีด ึีฃีถีกีฏีกีถ ีกีทีญีกีฟีกีฏีซึีถีฅึีซีถ
- **UV_THREADPOOL_SIZE** = 4 - ึีฃีถีกีฏีกีถ ีกีทีญีกีฟีกีฏีซึีถีฅึีซ by default ึีกีถีกีฏีจ (ีฝีก ีถีกึ ีฏีกีญีพีกีฎ ีง OSึีซึ)
- **Node.js runtime** - ีฃีธึีฎีกึีกีถีซ ีฟีถึึีฅีถ
- **sync / async non-blocking operations** - ีขีฅีผีฅึ, ีธึีธีถึ ีฏีกึีธีฒ ีง ีกีถึีกีฏีกึีถีฅีฌ ีกีพีกีฃ ีกีทีญีกีฟีกีฏีซึีจ
- **async & blocking CPU-intensive operations** - ีขีฅีผีฅึ, ีธึีธีถึ ีกีพีกีฃ ีกีทีญีกีฟีกีฏีซึีจ ีฐีกีถีฑีถีกึีกึีธึีด ีง ึีฃีถีกีฏีกีถ ีกีทีญีกีฟีกีฏีซึีถีฅึีซีถี ีฏีกีฟีกึีฅีฌีธึ ึ ีฆีฅีฏีธึึีฅีฌีธึ ีกึีคีตีธึีถึีจ

UV_THREADPOOL_SIZEึีจ ีดีฅีฎีกึีถีฅีฌีธึึี ีฏีฐีกีฝีถีซ ีบีกีฐ, ีฅึีข ีคีก ีกีตีฌึีฝ ีกีฆีคีฅึีธึีฉีตีธึีถ ีนีซ ีธึีถีฅีถีกึ ิดึีก ีฐีกีดีกึ ีบีฅีฟึ ีง ีซีดีกีถีกีฌ ีฐีกีดีกีฏีกึีฃีนีธึีด  threadึีฅึีซ ีดีกีฝีซีถึ

ิบีกีดีกีถีกีฏีกีฏีซึ ีฐีกีดีกีฏีกึีฃีซีนีถีฅึีซ ีฏีฅีถีฟึีธีถีธีฏีกีถ ีบึีธึีฅีฝีธึีถีฅึีซ (CPU) ึ ีดีซีปีธึีฏีถีฅึีซ (core) ีฉีซีพีจ ีฏีกึีธีฒ ีง ีฟีกึีขีฅึ ีฌีซีถีฅีฌี ีฏีกีญีพีกีฎ ึีซีฆีซีฏีกีฏีกีถ ีฏีกีผีธึึีพีกีฎึีซึ, ีขีกีตึ ีฝีธีพีธึีกีขีกึ ีคึีกีถึ ีธึีถีฅีถ ีดีฅีฏ CPU, ีดีซีถีนีคีฅีผ ีธึีธีท ีฝีฅึีพีฅึีถีฅึ, ีซีถีนีบีฅีฝ ีถีกึ HPC (high-performance computing)  ีฐีกีดีกีฏีกึีฃีฅึ ีฏีกึีธีฒ ีฅีถ ีธึีถีฅีถีกีฌ ีดีซ ึีกีถีซ ีบึีธึีฅีฝีธึ:
ีีฅีฏ CPUึีซ coreึีฅึีซ ึีกีถีกีฏีจ ีถีธึีตีถีบีฅีฝ ีฏีกึีธีฒ ีง ีทีกีฟ ีฟีกึีขีฅึ ีฌีซีถีฅีฌ 2 / 4 / 8 / 10 / 12 / 16 / 18 / 36 ึ ีกีพีฅีฌ, ีฝีกีฏีกีตีถ ีชีกีดีกีถีกีฏีกีฏีซึ ีบึีธึีฅีฝีธึีถีฅึีจ ีฝีธีพีธึีกีขีกึ ีธึีถีฅีถ 2 (dual-core) ีฏีกีด 4 (quad-core) core:
ิบีกีดีกีถีกีฏีกีฏีซึ CPUึีถีฅึีจ ีฐีกีณีกีญ ึีฃีฟีกีฃีธึีฎีธึีด ีฅีถ ีฟีฅีญีถีธีฌีธีฃีซีก, ีธึีจ ีฏีธีนีพีธึีด ีง hyper-threading, ีธึีจ ีฉีธึีตีฌ ีง ีฟีกีฌีซีฝ ีตีธึึีกึีกีถีนีตีธึึ CPU coreึีซีถ ีดีซีกีชีกีดีกีถีกีฏ ีฟึีกีดีกีคึีฅีฌ ีดีซ ึีกีถีซ threadึีฅึ, ีฝีธีพีธึีกีขีกึ ีคึีกีถึ ีดีกึีฝีซีดีกีฌ ึีกีถีกีฏีจ 2 ีง (ีธึีธีท ีคีฅีบึีฅึีธึีด` 4)ึ

<img src="https://i.imgur.com/ElvOPsN.png" style="width:100%;">
 
[[Concurrency and Multithreading](https://www.logicbig.com/quick-info/programming/multi-threading.html)]

ิฑีตีชีด ีธึีถีฅีถีกีฌีธีพ ีดีซ ึีธึึ ีบีกีฟีฏีฅึีกึีธึีด CPU-core-thread ึีธีญีฏีกีบีกีฏึีพีกีฎีธึีฉีตีกีถ ีดีกีฝีซีถ, ีฏีกึีธีฒ ีฅีถึ ีทีกึีธึีถีกีฏีฅีฌ thread pool ีดีฅีญีกีถีซีฆีดีซ ีดีกีฝีซีถ ีถีฏีกึีกีฃึีธึีฉีตีธึีถีจึ

ิดีซีฟีกึีฏีฅีถึ ีคีกีฝีฏีกีถ ีคีฅีบึ` ีชีกีดีกีถีกีฏีกีฏีซึ ีฐีกีดีกีฏีกึีฃีนีธึีด Node.jsึีซ ีกีทีญีกีฟีกีถึีจ, ีธึีฟีฅีฒ ีฏีก thread poolingึีซ ีกีถีฐึีกีชีฅีทีฟีธึีฉีตีธึีถึ ิฑีตีถ ีฏึีซีฟีซีฏีกีฏีกีถ ีคีฅีบึีธึีด, ีฅึีข Node.jsึีจ ีบีฅีฟึ ีง ีฏีกีฟีกึีซ ีขีกีฆีดีกีฉีซีพ CPU-intensive operationึีถีฅึ, ีธึีธีถึ ึีกีถีกีฏีจ ีดีฅีฎ ีง, ีฏีกีฟีกึีพีธึีด ีง coreึีฅึีซ ีฏีธีฒีดีซึ ีดีกึีฝีซีดีกีฌ threadึีฅึีซ ีฟึีกีดีกีคึีธึีด ีกีตีค operationึีถีฅึีจ ีฏีกีฟีกึีฅีฌีธึ ีฐีกีดีกึึ ีีฟีกึีพีธึีด ีงี ีธึ quad-core CPUึีธึีด ีฏีธึีถีฅีถีกีถึ 8 thread, ึ thread pool ีดีฅีญีกีถีซีฆีดีจ ีฟีฅีฝีกีฏีกีถีธึีฅีถ ีฏีกึีธีฒ ีง ีฏีซึีกีผีฅีฌ ีดีกึีฝีดีซีดีธึีด ีกีตีค 8 threadึีฅึีจ (ีกีตีค ีคีฅีบึีธึีด ีฟีฅีฒีซ ีฏีธึีถีฅีถีก CPU ีกีดีขีธีฒีปีกีฏีกีถ ีผีฅีฝีธึึีฝีถีฅึีซ ึีฃีฟีกีฃีธึีฎีธึีด):
ิฝีธึีฐีธึึีค ีง ีฟึีพีธึีด UV_THREADPOOL_SIZEึีจ ีธึีถีฅีถีกีฌ ีกีพีฅีฌีซ ึีซีน ึีกีถ ีฟีพีตีกีฌ CPUึีธึีด ีฐีถีกึีกีพีธึีซีถีฝ ีฟึีกีดีกีคึีพีธีฒ threadึีฅึีซ ึีกีถีกีฏีถ ีง, ีฝีกีฏีกีตีถ ีซีคีฅีกีฌีกีฏีกีถ ีคีฅีบึีถ ีกีตีถ ีง, ีฅึีข 4 coreึีธีพ (ีดีกึีฝีซีดีกีฌ 8 threadึีซ ีฐีถีกึีกีพีธึีธึีฉีตีกีดีข) CPUึีซ ีฐีกีดีกึ ีธึีถีฅีถีกีถึ UV_THREADPOOL_SIZEึีจ ีฐีฅีถึ 4, ีกีตีฝีซีถึีถ ีฐีฅีถึ coreึีฅึีซ ึีกีถีกีฏีธีพ, ีธึีบีฅีฝีฆีซ ีญีธึีฝีกึีฅีถึ OS-ีซ ีกีทีญีกีฟีกีถึีซ ีฎีกีถึีกีขีฅีผีถีพีกีฎีธึีฉีตีธึีถีซึึ

ีีทีฅีถึ ีถีกึ, ีธึ thread pool ีฏีกีฟีกึีพีธึีด ีง ีธีน ีขีธีฌีธึ ีกีฝีซีถีญึีธีถ operationึีถีฅึีซ ีคีฅีบึีธึีดึ
ีึีซีถีกีฏี https.request()-ีจ ึีกีถึีกีตีซีถ (Network I/O) ีดีธึีฟึ/ีฅีฌึ ีฃีธึีฎีธีฒีธึีฉีตีธึีถ ีง, ีกีตีฌ ีธีน ีบึีธึีฅีฝีธึีซึ ีฐีกีพีฅีฌีตีกีฌ ีผีฅีฝีธึึีฝ ีบีกีฐีกีถีปีธีฒ (CPU-intensive) ีฃีธึีฎีธีฒีธึีฉีตีธึีถ, ึ ีกีตีถ ีนีซ ึีฃีฟีกีฃีธึีฎีธึีด thread pool:
Thread pool ีกีถีฅีฌีธึ ึีธีญีกึีฅีถ, libUV-ีถ ีฟีพีตีกีฌ taskึีจ ึีธึีฑีธึีด ีง ีฌีธึีฎีฅีฌ ีกีถีดีซีปีกีฏีกีถ OS kernelึีซ ีดีซีปีธึีธีพี ึีฃีฟีกีฃีธึีฎีฅีฌีธีพ Network Cardึีจ (ีกีตีถีธึีกีดีฅีถีกีตีถีซีพ ีฝีก ีถีธึีตีบีฅีฝ ีธึีถีซ ีซึ ีฝีกีฐีดีกีถีกึีกีฏีธึีดีถีฅึีจ):
ีีกีฝีฟีธึีฅีถี Node.js-ีธึีด async ีดีฅีฉีธีคีถีฅึีจ ีดีทีกีฏีพีธึีด ีฅีถ libUV-ีซ ีฏีธีฒีดีซึ, ีขีกีตึ ีคึีกีถึ ีดีทีกีฏีพีธึีด ีฅีถ ีฅึีฏีธึ ีฟีกึีขีฅึ ีฅีฒีกีถีกีฏีถีฅึีธีพี ีฏีกีด native async ีดีฅีญีกีถีซีฆีดีธีพ (ึึีซีถีกีฏี [https.request()](https://nodejs.org/api/https.html#httpsrequestoptions-callback)ึีจ), ีฏีกีด thread poolึีซ ีดีซีปีธึีธีพ ([fs.createReadStream()](https://nodejs.org/api/fs.html#filehandlecreatereadstreamoptions)):
ีีกีดีฅีถีกีตีถ ีคีฅีบีฝ ีฐีถีกึีกีพีธึีธึีฉีตีกีถ ีคีฅีบึีธึีด libUV-ีถ ึีธึีฑีธึีด ีง ีญีธึีฝีกึีฅีฌ thread poolึีซ ีฏีซึีกีผีธึีดีซึี ีญีถีกีตีฅีฌีธีพ ีดีซีปีกีพีกีตึีธึีด ีผีฅีฝีธึึีฝีถีฅึีจ, ีซีฝีฏ ีฏึีซีฟีซีฏีกีฏีกีถ ีคีฅีบึีฅึีธึีด ีกีตีถ ึีฃีฟีกีฃีธึีฎีธึีด ีง ีฐีกีพีฅีฌีตีกีถ thread-ีฅึี ีฐีกีพีกีฟีกึีซีด ีดีถีกีฌีธีพ ีซึ ีฃีธึีฎีกีผีธึีตีฉีซีถ, ีกีตีถ ีงี ีบีกีฐีบีกีถีฅีฌ non-blocking (async) ีกีทีญีกีฟีกีถึึ

ิปีถีนีบีฅีฝ ีถีทีฅึีซีถึี JavaScript executionึีซ ีฐีกีดีกึ ีถีกีญีกีฟีฅีฝีพีกีฎ ีง ีดีฅีฏ thread (single-threaded)ึ ิฒีกีตึ ีฝีก ีกีฝีฅีฌีซีฝ ีบีฅีฟึ ีง ีฐีกีทีพีซ ีกีผีถีฅีฌ, ีธึ ีญีธีฝึีจ ีฃีถีธึีด ีง browserึีธึีด ีกีทีญีกีฟีธีฒ JavaScript engineึีซ ีดีกีฝีซีถึ ิปีฐีกึีฏีฅ ีฝีก ีพีฅึีกีขีฅึีธึีด ีง ีถีกึ Node.jsึีซีถ, ีขีกีตึ ีกึีชีซ ีซีดีกีถีกีฌ ีถีกึ ีธึ browserึีซึ ีคีธึึีฝ ีฏีกึีธีฒ ีฅีถ ีฃีธีตีธึีฉีตีธึีถ ีธึีถีฅีถีกีฌ ีถีกึ multithread runtime environmentึีถีฅึี ีซีถีนีบีซีฝีซีถ ีงึ Microsoftึีซ [Napa.js](https://github.com/microsoft/napajs)ึีจ, ีธึีซ ีพึีก ีกีทีญีกีฟีกีถึีจ ีคีกีคีกึีฅีฌ ีง 2018ึีซีถึ ีึีก ีดีกีฝีซีถ ีฏีดีกีถึีกีดีกีฝีถีฅีถึ ีฐีธีคีพีกีฎีกีทีกึีซ [ีดีกีฝ 7](https://medium.com/@boolfalse/javascript-%D5%AC%D5%A5%D5%A6%D5%B8%D6%82-runtime-engine-%D5%B4%D5%AB%D5%BB%D5%A1%D5%BE%D5%A1%D5%B5%D6%80-node-js-%D5%B4%D6%80%D6%81%D5%A1%D5%AF%D5%AB%D6%81%D5%B6%D5%A5%D6%80-deno-bun-82cf3222e94b)ึีธึีดึ

NGNTJS ีฐีธีคีพีกีฎีถีฅึีซ ีทีกึึีซ ีกีตีฝ ีดีกีฝีธึีด ีฎีกีถีธีฉีกึีกีถึ thread pool ีฃีกีฒีกึีกึีซ ีฐีฅีฟ, ึ ีคึีก ีฃีธึีฎีถีกีฏีกีถ ึึีซีถีกีฏีจ ีบึีธีตีฅีฏีฟีฅึีซีถึ ีผีฅีกีฌ ีฏีตีกีถึีซึ ีพีฅึึีพีกีฎ ีคีฅีบึีซ ีพึีกึ
ีีกีปีธึีคี [ีดีกีฝ 6](https://medium.com/@boolfalse/event-loop-%D5%A8-%D5%BA%D6%80%D5%A1%D5%AF%D5%BF%D5%AB%D5%AF-%D6%85%D6%80%D5%AB%D5%B6%D5%A1%D5%AF%D5%B6%D5%A5%D6%80%D5%B8%D5%BE-%D5%A8%D5%B6%D5%A4%D5%B0%D5%A1%D5%B6%D5%B8%D6%82%D6%80-%D5%BA%D5%A1%D5%BF%D5%AF%D5%A5%D6%80-363eff47b6c9)ึีธึีด ีฏีธึีฝีธึีดีถีกีฝีซึีฅีถึ event-loop ีดีฅีญีกีถีซีฆีดีจ ีฃีธึีฎีถีกีฏีกีถ ึึีซีถีกีฏีถีฅึีซ ีดีซีปีธึีธีพ, ีฏีฌีซีถีซ ีฎีกีถีธีฉีธึีฉีตีธึีถ Reactor Patternึีซ ีกีทีญีกีฟีกีถึีซ ีฐีฅีฟึ

***

ิตีฉีฅ ีฐีกีพีกีถีฅึีซึ ีกีตีฝ ีถีตีธึีฉีจ, ีกีฆีกีฟ ีฏีกึีธีฒ ีฅึ ีฐีฅีฟึีฅีฌ ีซีถีฑ ีกีตีฝีฟีฅีฒึ ๐

ิบีกีดีกีถีกีฏีกีฏีซึ ีฟีกึีขีฅึ ีฟีฅีญีถีธีฌีธีฃีซีกีถีฅึีธีพ ีกีทีญีกีฟีธีฒ ีบึีธีตีฅีฏีฟีถีฅึ ีธึีฝีธึีดีถีกีฝีซึีฅีฌีธึ ีฐีกีดีกึ ีฏีกึีธีฒ ีฅึ ีฐีฅีฟึีฅีฌ ีซีด [GitHub](https://github.com/boolfalse) ีงีปีซีถ, ีธึีฟีฅีฒ ีฅีฝ ีกีฏีฟีซีพีธึีฅีถ ีฐีกีถึีกีตีถีกึีถีธึีด ีฅีด ีซีด ีฏีกีฟีกึีกีฎ ีกีทีญีกีฟีกีถึีซ ีฆีฃีกีฌีซ ีดีกีฝีจึ

ิฑีตีฌ ีซีถึีธีซ ีฐีกีดีกึ ีฏีกึีธีฒ ีฅึ ีกีตึีฅีฌีฅีฌ ีซีด ึึีซึีซีกีฌ ีฏีกีตึ` [https://boolfalse.com/](https://boolfalse.com/)
